# AWS CloudFormation Cost Estimator PRD

## Overview
A Python-based solution to estimate costs of AWS CloudFormation stacks generated by CDK, with a focus on providing detailed cost analysis for pull request reviews and deployment planning.

## Goals
- Provide accurate cost estimates for CloudFormation stacks
- Support both new stack deployments and stack updates
- Generate detailed, tabular cost breakdowns
- Integrate with GitHub Actions for automated cost analysis
- Support all AWS resources supported by Infracost and AWS Pricing API

## Non-Goals
- Real-time cost tracking
- Historical cost analysis
- Usage-based cost predictions
- Cost optimization recommendations

## Solution Architecture

### Components

1. **Core Cost Estimation Engine**
   - Python-based cost calculation module
   - Integration with Infracost API (primary)
   - Fallback to AWS Pricing API
   - Resource type mapping and validation

2. **Stack Analysis Module**
   - CloudFormation template parsing
   - Resource extraction and categorization
   - Diff analysis between current and proposed stacks

3. **Output Formatter**
   - Tabular cost breakdown generation
   - Markdown formatting for GitHub comments
   - Detailed resource-level cost information

4. **GitHub Actions Integration**
   - Workflow trigger on PR comments
   - Automated cost analysis
   - Comment posting with results

### File Structure
```
.
├── src/
│   ├── __init__.py
│   ├── cost_estimator/
│   │   ├── __init__.py
│   │   ├── core.py           # Core cost calculation logic
│   │   ├── infracost.py      # Infracost API integration
│   │   ├── aws_pricing.py    # AWS Pricing API integration
│   │   └── resource_map.py   # Resource type mapping
│   ├── stack_analyzer/
│   │   ├── __init__.py
│   │   ├── parser.py         # CFN template parsing
│   │   └── diff.py          # Stack diff analysis
│   └── formatter/
│       ├── __init__.py
│       └── output.py         # Output formatting
├── tests/
│   └── ...
├── .github/
│   └── workflows/
│       └── cost-analysis.yml # GitHub Actions workflow
├── templates/
│   └── test-stack.yaml      # Test CloudFormation template
├── requirements.txt
├── README.md
└── PRD.md
```

## Implementation Plan

### Phase 1: Core Infrastructure
1. Set up project structure and dependencies
2. Implement basic CloudFormation template parsing
3. Create resource type mapping system

### Phase 2: Cost Calculation
1. Implement Infracost API integration
2. Add AWS Pricing API fallback
3. Create cost calculation engine

### Phase 3: Stack Analysis
1. Implement stack diff analysis
2. Add resource categorization
3. Create cost comparison logic

### Phase 4: Output & Integration
1. Implement markdown formatter
2. Create GitHub Actions workflow
3. Add test templates and documentation

## Technical Requirements

### Dependencies
- Python 3.8+
- boto3
- requests
- pyyaml
- tabulate
- pytest (for testing)

### API Requirements
- Infracost API access
- AWS Pricing API access
- GitHub API access

### Security Considerations
- Secure API key storage
- IAM role configuration
- GitHub token management

## Testing Strategy
1. Unit tests for core components
2. Integration tests for API interactions
3. End-to-end tests with sample templates
4. GitHub Actions workflow testing

## Success Metrics
1. Accurate cost estimation for supported resources
2. Successful integration with GitHub Actions
3. Clear and readable output format
4. Comprehensive resource coverage

## Future Enhancements
1. Cost optimization recommendations
2. Historical cost tracking
3. Usage-based cost predictions
4. Custom resource support
5. Multi-region support 